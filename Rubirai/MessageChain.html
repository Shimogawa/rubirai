<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Rubirai::MessageChain
  
    &mdash; Documentation by YARD 0.9.27
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Rubirai::MessageChain";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (M)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Rubirai.html" title="Rubirai (module)">Rubirai</a></span></span>
     &raquo; 
    <span class="title">MessageChain</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Rubirai::MessageChain
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'>Object</span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'>Object</span></li>
          
            <li class="next">Rubirai::MessageChain</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd>Enumerable</dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/rubirai/messages/interpolation.rb<span class="defines">,<br />
  lib/rubirai/messages/message_chain.rb</span>
</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>Message chain</p>


  </div>
</div>
<div class="tags">
  

</div>



  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#bot-instance_method" title="#bot (instance method)">#<strong>bot</strong>  &#x21d2; Bot </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The bot object.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#has_interpolation-instance_method" title="#has_interpolation (instance method)">#<strong>has_interpolation</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>If this message chain has interpolation called by <span class='object_link'><a href="#interpolated_str-instance_method" title="Rubirai::MessageChain#interpolated_str (method)">#interpolated_str</a></span>.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#id-instance_method" title="#id (instance method)">#<strong>id</strong>  &#x21d2; Integer<sup>?</sup> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The message id, may be <code>nil</code>.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#messages-instance_method" title="#messages (instance method)">#<strong>messages</strong>  &#x21d2; Array&lt;Message&gt; </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The raw message array.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#raw-instance_method" title="#raw (instance method)">#<strong>raw</strong>  &#x21d2; Hash{String =&gt; Object}<sup>?</sup> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The raw message chain, may be <code>nil</code>.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#send_time-instance_method" title="#send_time (instance method)">#<strong>send_time</strong>  &#x21d2; Integer<sup>?</sup> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The send time of the message chain, may be <code>nil</code>.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#make-class_method" title="make (class method)">.<strong>make</strong>(*messages, bot: nil)  &#x21d2; Rubirai::MessageChain </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Makes a message chain from a list of messages.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#[]-instance_method" title="#[] (instance method)">#<strong>[]</strong>(idx)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#chain_from_interpolated-instance_method" title="#chain_from_interpolated (instance method)">#<strong>chain_from_interpolated</strong>(str)  &#x21d2; MessageChain </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Get a new chain from interpolated string generated from the original message chain.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#concat!-instance_method" title="#concat! (instance method)">#<strong>concat!</strong>(msg_chain)  &#x21d2; MessageChain </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Concats this message chain with another one.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#each-instance_method" title="#each (instance method)">#<strong>each</strong>(&amp;block)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#empty%3F-instance_method" title="#empty? (instance method)">#<strong>empty?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#extend-instance_method" title="#extend (instance method)">#<strong>extend</strong>(*messages)  &#x21d2; Rubirai::MessageChain </a>
    

    
      (also: #&lt;&lt;, #append)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Append messages to this message chain.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_object-instance_method" title="#get_object (instance method)">#<strong>get_object</strong>(obj_id)  &#x21d2; Message<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Get the interpolated object by given id.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#interpolated_str-instance_method" title="#interpolated_str (instance method)">#<strong>interpolated_str</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Convert the message chain to an interpolated string.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#length-instance_method" title="#length (instance method)">#<strong>length</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#size-instance_method" title="#size (instance method)">#<strong>size</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_a-instance_method" title="#to_a (instance method)">#<strong>to_a</strong>  &#x21d2; Array&lt;Hash{String =&gt; Object}&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Convert the message chain to an array of hashes.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="bot-instance_method">
  
    #<strong>bot</strong>  &#x21d2; <tt><span class='object_link'><a href="Bot.html" title="Rubirai::Bot (class)">Bot</a></span></tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the bot object.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Bot.html" title="Rubirai::Bot (class)">Bot</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the bot object</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubirai/messages/message_chain.rb', line 19</span>

<span class='kw'>class</span> <span class='const'><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">MessageChain</a></span></span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Enumerable</span>

  <span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:bot</span><span class='comma'>,</span> <span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:raw</span><span class='comma'>,</span> <span class='symbol'>:send_time</span><span class='comma'>,</span> <span class='symbol'>:messages</span>

  <span class='comment'># Makes a message chain from a list of messages
</span>  <span class='comment'>#
</span>  <span class='comment'># @param messages [Array&lt;Rubirai::Message, Rubirai::MessageChain, Hash, String, Object&gt;] a list of messages
</span>  <span class='comment'># @param bot [Rubirai::Bot, nil]
</span>  <span class='comment'># @return [Rubirai::MessageChain] the message chain
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_make'>make</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_messages'>messages</span><span class='comma'>,</span> <span class='label'>bot:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_chain'>chain</span> <span class='op'>=</span> <span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_bot'>bot</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span> <span class='const'><span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Message</a></span></span><span class='period'>.</span><span class='id identifier rubyid_to_message'><span class='object_link'><a href="Message.html#to_message-class_method" title="Rubirai::Message.to_message (method)">to_message</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='id identifier rubyid_bot'>bot</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="PlainMessage.html" title="Rubirai::PlainMessage (class)">PlainMessage</a></span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="PlainMessage.html" title="Rubirai::PlainMessage (class)">PlainMessage</a></span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="PlainMessage.html" title="Rubirai::PlainMessage (class)">PlainMessage</a></span></span><span class='period'>.</span><span class='id identifier rubyid_from'><span class='object_link'><a href="PlainMessage.html#from-class_method" title="Rubirai::PlainMessage.from (method)">from</a></span></span><span class='lparen'>(</span><span class='label'>text:</span> <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span> <span class='op'>+</span> <span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span><span class='comma'>,</span> <span class='label'>bot:</span> <span class='id identifier rubyid_bot'>bot</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span> <span class='id identifier rubyid_msg'>msg</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_chain'>chain</span><span class='period'>.</span><span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_chain'>chain</span>
  <span class='kw'>end</span>

  <span class='comment'># Append messages to this message chain
</span>  <span class='comment'>#
</span>  <span class='comment'># @param messages [Array&lt;Rubirai::Message, Hash&gt;] a list of messages
</span>  <span class='comment'># @return [Rubirai::MessageChain] self
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_messages'>messages</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span>
      <span class='id identifier rubyid_internal_append'>internal_append</span> <span class='id identifier rubyid_msg'>msg</span>
    <span class='kw'>end</span>
    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>alias</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_extend'>extend</span>
  <span class='kw'>alias</span> <span class='id identifier rubyid_append'>append</span> <span class='id identifier rubyid_extend'>extend</span>

  <span class='comment'># Concats this message chain with another one
</span>  <span class='comment'>#
</span>  <span class='comment'># @param msg_chain [MessageChain] another message chain
</span>  <span class='comment'># @return [MessageChain] self
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_concat!'>concat!</span><span class='lparen'>(</span><span class='id identifier rubyid_msg_chain'>msg_chain</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_msg_chain'>msg_chain</span><span class='period'>.</span><span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span>
      <span class='id identifier rubyid_internal_append'>internal_append</span> <span class='id identifier rubyid_msg'>msg</span>
    <span class='kw'>end</span>
    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='op'>[]</span><span class='lparen'>(</span><span class='id identifier rubyid_idx'>idx</span><span class='rparen'>)</span>
    <span class='ivar'>@messages</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_length'>length</span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_size'>size</span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_empty?'>empty?</span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='kw'>end</span>

  <span class='comment'># Don&#39;t use the constructor. Use {.make}.
</span>  <span class='comment'>#
</span>  <span class='comment'># @private
</span>  <span class='comment'># @param bot [Rubirai::Bot, nil]
</span>  <span class='comment'># @param source [Array, nil]
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_bot'>bot</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_source'>source</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='ivar'>@bot</span> <span class='op'>=</span> <span class='id identifier rubyid_bot'>bot</span>
    <span class='ivar'>@messages</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='ivar'>@has_interpolation</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='ivar'>@interpolated_str</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='ivar'>@ipl_objs_map</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='ivar'>@raw</span> <span class='op'>=</span> <span class='id identifier rubyid_source'>source</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_source'>source</span>
    <span class='id identifier rubyid_raise'>raise</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="MiraiError.html" title="Rubirai::MiraiError (class)">MiraiError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>source is not array</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Array</span>
    <span class='id identifier rubyid_raise'>raise</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="MiraiError.html" title="Rubirai::MiraiError (class)">MiraiError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>length is zero</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_source'>source</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>type</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Source</span><span class='tstring_end'>&#39;</span></span>
      <span class='ivar'>@id</span> <span class='op'>=</span> <span class='id identifier rubyid_source'>source</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
      <span class='ivar'>@send_time</span> <span class='op'>=</span> <span class='id identifier rubyid_source'>source</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>time</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_drop'>drop</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_source'>source</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Convert the message chain to an array of hashes.
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Array&lt;Hash{String =&gt; Object}&gt;]
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_to_a'>to_a</span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_h</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_private'>private</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_internal_append'>internal_append</span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_must_be!'>must_be!</span> <span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Message</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">MessageChain</a></span></span><span class='comma'>,</span> <span class='const'>Hash</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="RubiraiError.html" title="Rubirai::RubiraiError (class)">RubiraiError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>msg must be Message, MessageChain, or Hash</span><span class='tstring_end'>&#39;</span></span>

    <span class='kw'>case</span> <span class='id identifier rubyid_msg'>msg</span>
    <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Message</a></span></span>
      <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span> <span class='id identifier rubyid_msg'>msg</span>
    <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">MessageChain</a></span></span>
      <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_messages'>messages</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span> <span class='const'><span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Message</a></span></span><span class='period'>.</span><span class='id identifier rubyid_build_from'>build_from</span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='ivar'>@bot</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>self</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="has_interpolation-instance_method">
  
    #<strong>has_interpolation</strong>  &#x21d2; <tt>Boolean</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns if this message chain has interpolation called by <span class='object_link'><a href="#interpolated_str-instance_method" title="Rubirai::MessageChain#interpolated_str (method)">#interpolated_str</a></span>.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>if this message chain has interpolation called by <span class='object_link'><a href="#interpolated_str-instance_method" title="Rubirai::MessageChain#interpolated_str (method)">#interpolated_str</a></span></p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubirai/messages/interpolation.rb', line 8</span>

<span class='kw'>class</span> <span class='const'><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">MessageChain</a></span></span>
  <span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:has_interpolation</span>

  <span class='comment'># Convert the message chain to an interpolated string.
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [String]
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_interpolated_str'>interpolated_str</span>
    <span class='kw'>return</span> <span class='ivar'>@interpolated_str</span> <span class='kw'>if</span> <span class='ivar'>@has_interpolation</span>
    <span class='ivar'>@interpolated_str</span> <span class='op'>=</span> <span class='id identifier rubyid__gen_interp_str'>_gen_interp_str</span>
    <span class='ivar'>@has_interpolation</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='ivar'>@interpolated_str</span>
  <span class='kw'>end</span>

  <span class='comment'># Get the interpolated object by given id
</span>  <span class='comment'>#
</span>  <span class='comment'># @param obj_id [String] the object id
</span>  <span class='comment'># @return [Message, nil] the message. `nil` if `obj_id` is malformed or not found.
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_get_object'>get_object</span><span class='lparen'>(</span><span class='id identifier rubyid_obj_id'>obj_id</span><span class='rparen'>)</span>
    <span class='id identifier rubyid__get_object'>_get_object</span><span class='lparen'>(</span><span class='id identifier rubyid_obj_id'>obj_id</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Get a new chain from interpolated string generated from the original message chain.
</span>  <span class='comment'># The given interpolated string can be a substring of original one so that elements
</span>  <span class='comment'># can be extracted easily.
</span>  <span class='comment'>#
</span>  <span class='comment'># @param str [String] the interpolated string
</span>  <span class='comment'># @return [MessageChain] the message chain constructed
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_chain_from_interpolated'>chain_from_interpolated</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='rparen'>)</span>
    <span class='id identifier rubyid__interpolate_with_objects'>_interpolate_with_objects</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_private'>private</span>

  <span class='const'>OBJ_INTERP_CHAR</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%</span><span class='tstring_end'>&#39;</span></span>
  <span class='const'>OBJ_INTERP_LEN</span> <span class='op'>=</span> <span class='int'>6</span>

  <span class='kw'>def</span> <span class='id identifier rubyid__gen_interp_str'>_gen_interp_str</span>
    <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='op'>+</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span>
      <span class='id identifier rubyid_result'>result</span> <span class='op'>&lt;&lt;</span> <span class='kw'>case</span> <span class='id identifier rubyid_msg'>msg</span>
                <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="PlainMessage.html" title="Rubirai::PlainMessage (class)">PlainMessage</a></span></span>
                  <span class='id identifier rubyid__transform_plain_txt'>_transform_plain_txt</span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span><span class='rparen'>)</span>
                <span class='kw'>else</span>
                  <span class='id identifier rubyid__transform_object'>_transform_object</span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='rparen'>)</span>
                <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_result'>result</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid__transform_plain_txt'>_transform_plain_txt</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_str'>str</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='const'>OBJ_INTERP_CHAR</span><span class='comma'>,</span> <span class='const'>OBJ_INTERP_CHAR</span> <span class='op'>*</span> <span class='int'>2</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid__transform_object'>_transform_object</span><span class='lparen'>(</span><span class='id identifier rubyid_obj'>obj</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_obj_id'>obj_id</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Utils.html" title="Rubirai::Utils (module)">Utils</a></span></span><span class='period'>.</span><span class='id identifier rubyid_random_str'><span class='object_link'><a href="Utils.html#random_str-class_method" title="Rubirai::Utils.random_str (method)">random_str</a></span></span><span class='lparen'>(</span><span class='const'>OBJ_INTERP_LEN</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_obj_id'>obj_id</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Utils.html" title="Rubirai::Utils (module)">Utils</a></span></span><span class='period'>.</span><span class='id identifier rubyid_random_str'><span class='object_link'><a href="Utils.html#random_str-class_method" title="Rubirai::Utils.random_str (method)">random_str</a></span></span><span class='lparen'>(</span><span class='const'>OBJ_INTERP_LEN</span><span class='rparen'>)</span> <span class='kw'>while</span> <span class='ivar'>@ipl_objs_map</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_obj_id'>obj_id</span><span class='rparen'>)</span>
    <span class='ivar'>@ipl_objs_map</span><span class='lbracket'>[</span><span class='id identifier rubyid_obj_id'>obj_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_obj'>obj</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>OBJ_INTERP_CHAR</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_obj_id'>obj_id</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='const'>OBJ_INTERP_CHAR</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid__get_object'>_get_object</span><span class='lparen'>(</span><span class='id identifier rubyid_obj_id'>obj_id</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_obj_id'>obj_id</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>!=</span> <span class='const'>OBJ_INTERP_LEN</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_obj_id'>obj_id</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>!=</span> <span class='lparen'>(</span><span class='const'>OBJ_INTERP_LEN</span> <span class='op'>+</span> <span class='int'>2</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='ivar'>@ipl_objs_map</span><span class='lbracket'>[</span><span class='id identifier rubyid_obj_id'>obj_id</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_obj_id'>obj_id</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='const'>OBJ_INTERP_LEN</span>
    <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_obj_id'>obj_id</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='const'>OBJ_INTERP_CHAR</span> <span class='op'>||</span> <span class='id identifier rubyid_obj_id'>obj_id</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='const'>OBJ_INTERP_CHAR</span>

    <span class='ivar'>@ipl_objs_map</span><span class='lbracket'>[</span><span class='id identifier rubyid_obj_id'>obj_id</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>...</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='comment'># @private
</span>  <span class='comment'># @param str [String]
</span>  <span class='kw'>def</span> <span class='id identifier rubyid__interpolate_with_objects'>_interpolate_with_objects</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_sb'>sb</span> <span class='op'>=</span> <span class='op'>+</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">MessageChain</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_bot'>bot</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_i'>i</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='kw'>while</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_str'>str</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>==</span> <span class='id identifier rubyid_str'>str</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>-</span> <span class='int'>1</span>
        <span class='id identifier rubyid_sb'>sb</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_str'>str</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span>
        <span class='kw'>break</span>
      <span class='kw'>end</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_str'>str</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='const'>OBJ_INTERP_CHAR</span>
        <span class='id identifier rubyid_sb'>sb</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_str'>str</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_i'>i</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='kw'>next</span>
      <span class='kw'>end</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_str'>str</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span> <span class='op'>+</span> <span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='const'>OBJ_INTERP_CHAR</span>
        <span class='id identifier rubyid_sb'>sb</span> <span class='op'>&lt;&lt;</span> <span class='const'>OBJ_INTERP_CHAR</span>
        <span class='id identifier rubyid_i'>i</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span> <span class='const'><span class='object_link'><a href="PlainMessage.html" title="Rubirai::PlainMessage (class)">PlainMessage</a></span></span><span class='period'>.</span><span class='id identifier rubyid_from'><span class='object_link'><a href="PlainMessage.html#from-class_method" title="Rubirai::PlainMessage.from (method)">from</a></span></span><span class='lparen'>(</span><span class='label'>text:</span> <span class='id identifier rubyid_sb'>sb</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_sb'>sb</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='id identifier rubyid_sb'>sb</span> <span class='op'>=</span> <span class='id identifier rubyid_str'>str</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>...</span><span class='id identifier rubyid_i'>i</span> <span class='op'>+</span> <span class='const'>OBJ_INTERP_LEN</span> <span class='op'>+</span> <span class='int'>2</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_obj'>obj</span> <span class='op'>=</span> <span class='id identifier rubyid__get_object'>_get_object</span><span class='lparen'>(</span><span class='id identifier rubyid_sb'>sb</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_i'>i</span> <span class='op'>+=</span> <span class='const'>OBJ_INTERP_LEN</span> <span class='op'>+</span> <span class='int'>1</span>
        <span class='kw'>unless</span> <span class='id identifier rubyid_obj'>obj</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
          <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span> <span class='id identifier rubyid_obj'>obj</span>
          <span class='id identifier rubyid_sb'>sb</span> <span class='op'>=</span> <span class='op'>+</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_i'>i</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span> <span class='const'><span class='object_link'><a href="PlainMessage.html" title="Rubirai::PlainMessage (class)">PlainMessage</a></span></span><span class='period'>.</span><span class='id identifier rubyid_from'><span class='object_link'><a href="PlainMessage.html#from-class_method" title="Rubirai::PlainMessage.from (method)">from</a></span></span><span class='lparen'>(</span><span class='label'>text:</span> <span class='id identifier rubyid_sb'>sb</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_sb'>sb</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_sb'>sb</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_result'>result</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="id-instance_method">
  
    #<strong>id</strong>  &#x21d2; <tt>Integer</tt><sup>?</sup>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the message id, may be <code>nil</code>.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the message id, may be <code>nil</code></p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubirai/messages/message_chain.rb', line 19</span>

<span class='kw'>class</span> <span class='const'><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">MessageChain</a></span></span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Enumerable</span>

  <span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:bot</span><span class='comma'>,</span> <span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:raw</span><span class='comma'>,</span> <span class='symbol'>:send_time</span><span class='comma'>,</span> <span class='symbol'>:messages</span>

  <span class='comment'># Makes a message chain from a list of messages
</span>  <span class='comment'>#
</span>  <span class='comment'># @param messages [Array&lt;Rubirai::Message, Rubirai::MessageChain, Hash, String, Object&gt;] a list of messages
</span>  <span class='comment'># @param bot [Rubirai::Bot, nil]
</span>  <span class='comment'># @return [Rubirai::MessageChain] the message chain
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_make'>make</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_messages'>messages</span><span class='comma'>,</span> <span class='label'>bot:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_chain'>chain</span> <span class='op'>=</span> <span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_bot'>bot</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span> <span class='const'><span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Message</a></span></span><span class='period'>.</span><span class='id identifier rubyid_to_message'><span class='object_link'><a href="Message.html#to_message-class_method" title="Rubirai::Message.to_message (method)">to_message</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='id identifier rubyid_bot'>bot</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="PlainMessage.html" title="Rubirai::PlainMessage (class)">PlainMessage</a></span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="PlainMessage.html" title="Rubirai::PlainMessage (class)">PlainMessage</a></span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="PlainMessage.html" title="Rubirai::PlainMessage (class)">PlainMessage</a></span></span><span class='period'>.</span><span class='id identifier rubyid_from'><span class='object_link'><a href="PlainMessage.html#from-class_method" title="Rubirai::PlainMessage.from (method)">from</a></span></span><span class='lparen'>(</span><span class='label'>text:</span> <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span> <span class='op'>+</span> <span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span><span class='comma'>,</span> <span class='label'>bot:</span> <span class='id identifier rubyid_bot'>bot</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span> <span class='id identifier rubyid_msg'>msg</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_chain'>chain</span><span class='period'>.</span><span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_chain'>chain</span>
  <span class='kw'>end</span>

  <span class='comment'># Append messages to this message chain
</span>  <span class='comment'>#
</span>  <span class='comment'># @param messages [Array&lt;Rubirai::Message, Hash&gt;] a list of messages
</span>  <span class='comment'># @return [Rubirai::MessageChain] self
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_messages'>messages</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span>
      <span class='id identifier rubyid_internal_append'>internal_append</span> <span class='id identifier rubyid_msg'>msg</span>
    <span class='kw'>end</span>
    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>alias</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_extend'>extend</span>
  <span class='kw'>alias</span> <span class='id identifier rubyid_append'>append</span> <span class='id identifier rubyid_extend'>extend</span>

  <span class='comment'># Concats this message chain with another one
</span>  <span class='comment'>#
</span>  <span class='comment'># @param msg_chain [MessageChain] another message chain
</span>  <span class='comment'># @return [MessageChain] self
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_concat!'>concat!</span><span class='lparen'>(</span><span class='id identifier rubyid_msg_chain'>msg_chain</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_msg_chain'>msg_chain</span><span class='period'>.</span><span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span>
      <span class='id identifier rubyid_internal_append'>internal_append</span> <span class='id identifier rubyid_msg'>msg</span>
    <span class='kw'>end</span>
    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='op'>[]</span><span class='lparen'>(</span><span class='id identifier rubyid_idx'>idx</span><span class='rparen'>)</span>
    <span class='ivar'>@messages</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_length'>length</span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_size'>size</span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_empty?'>empty?</span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='kw'>end</span>

  <span class='comment'># Don&#39;t use the constructor. Use {.make}.
</span>  <span class='comment'>#
</span>  <span class='comment'># @private
</span>  <span class='comment'># @param bot [Rubirai::Bot, nil]
</span>  <span class='comment'># @param source [Array, nil]
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_bot'>bot</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_source'>source</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='ivar'>@bot</span> <span class='op'>=</span> <span class='id identifier rubyid_bot'>bot</span>
    <span class='ivar'>@messages</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='ivar'>@has_interpolation</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='ivar'>@interpolated_str</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='ivar'>@ipl_objs_map</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='ivar'>@raw</span> <span class='op'>=</span> <span class='id identifier rubyid_source'>source</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_source'>source</span>
    <span class='id identifier rubyid_raise'>raise</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="MiraiError.html" title="Rubirai::MiraiError (class)">MiraiError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>source is not array</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Array</span>
    <span class='id identifier rubyid_raise'>raise</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="MiraiError.html" title="Rubirai::MiraiError (class)">MiraiError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>length is zero</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_source'>source</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>type</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Source</span><span class='tstring_end'>&#39;</span></span>
      <span class='ivar'>@id</span> <span class='op'>=</span> <span class='id identifier rubyid_source'>source</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
      <span class='ivar'>@send_time</span> <span class='op'>=</span> <span class='id identifier rubyid_source'>source</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>time</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_drop'>drop</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_source'>source</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Convert the message chain to an array of hashes.
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Array&lt;Hash{String =&gt; Object}&gt;]
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_to_a'>to_a</span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_h</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_private'>private</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_internal_append'>internal_append</span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_must_be!'>must_be!</span> <span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Message</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">MessageChain</a></span></span><span class='comma'>,</span> <span class='const'>Hash</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="RubiraiError.html" title="Rubirai::RubiraiError (class)">RubiraiError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>msg must be Message, MessageChain, or Hash</span><span class='tstring_end'>&#39;</span></span>

    <span class='kw'>case</span> <span class='id identifier rubyid_msg'>msg</span>
    <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Message</a></span></span>
      <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span> <span class='id identifier rubyid_msg'>msg</span>
    <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">MessageChain</a></span></span>
      <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_messages'>messages</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span> <span class='const'><span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Message</a></span></span><span class='period'>.</span><span class='id identifier rubyid_build_from'>build_from</span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='ivar'>@bot</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>self</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="messages-instance_method">
  
    #<strong>messages</strong>  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Message</a></span>&gt;</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the raw message array.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Message</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the raw message array</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubirai/messages/message_chain.rb', line 19</span>

<span class='kw'>class</span> <span class='const'><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">MessageChain</a></span></span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Enumerable</span>

  <span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:bot</span><span class='comma'>,</span> <span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:raw</span><span class='comma'>,</span> <span class='symbol'>:send_time</span><span class='comma'>,</span> <span class='symbol'>:messages</span>

  <span class='comment'># Makes a message chain from a list of messages
</span>  <span class='comment'>#
</span>  <span class='comment'># @param messages [Array&lt;Rubirai::Message, Rubirai::MessageChain, Hash, String, Object&gt;] a list of messages
</span>  <span class='comment'># @param bot [Rubirai::Bot, nil]
</span>  <span class='comment'># @return [Rubirai::MessageChain] the message chain
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_make'>make</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_messages'>messages</span><span class='comma'>,</span> <span class='label'>bot:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_chain'>chain</span> <span class='op'>=</span> <span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_bot'>bot</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span> <span class='const'><span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Message</a></span></span><span class='period'>.</span><span class='id identifier rubyid_to_message'><span class='object_link'><a href="Message.html#to_message-class_method" title="Rubirai::Message.to_message (method)">to_message</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='id identifier rubyid_bot'>bot</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="PlainMessage.html" title="Rubirai::PlainMessage (class)">PlainMessage</a></span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="PlainMessage.html" title="Rubirai::PlainMessage (class)">PlainMessage</a></span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="PlainMessage.html" title="Rubirai::PlainMessage (class)">PlainMessage</a></span></span><span class='period'>.</span><span class='id identifier rubyid_from'><span class='object_link'><a href="PlainMessage.html#from-class_method" title="Rubirai::PlainMessage.from (method)">from</a></span></span><span class='lparen'>(</span><span class='label'>text:</span> <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span> <span class='op'>+</span> <span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span><span class='comma'>,</span> <span class='label'>bot:</span> <span class='id identifier rubyid_bot'>bot</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span> <span class='id identifier rubyid_msg'>msg</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_chain'>chain</span><span class='period'>.</span><span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_chain'>chain</span>
  <span class='kw'>end</span>

  <span class='comment'># Append messages to this message chain
</span>  <span class='comment'>#
</span>  <span class='comment'># @param messages [Array&lt;Rubirai::Message, Hash&gt;] a list of messages
</span>  <span class='comment'># @return [Rubirai::MessageChain] self
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_messages'>messages</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span>
      <span class='id identifier rubyid_internal_append'>internal_append</span> <span class='id identifier rubyid_msg'>msg</span>
    <span class='kw'>end</span>
    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>alias</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_extend'>extend</span>
  <span class='kw'>alias</span> <span class='id identifier rubyid_append'>append</span> <span class='id identifier rubyid_extend'>extend</span>

  <span class='comment'># Concats this message chain with another one
</span>  <span class='comment'>#
</span>  <span class='comment'># @param msg_chain [MessageChain] another message chain
</span>  <span class='comment'># @return [MessageChain] self
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_concat!'>concat!</span><span class='lparen'>(</span><span class='id identifier rubyid_msg_chain'>msg_chain</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_msg_chain'>msg_chain</span><span class='period'>.</span><span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span>
      <span class='id identifier rubyid_internal_append'>internal_append</span> <span class='id identifier rubyid_msg'>msg</span>
    <span class='kw'>end</span>
    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='op'>[]</span><span class='lparen'>(</span><span class='id identifier rubyid_idx'>idx</span><span class='rparen'>)</span>
    <span class='ivar'>@messages</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_length'>length</span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_size'>size</span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_empty?'>empty?</span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='kw'>end</span>

  <span class='comment'># Don&#39;t use the constructor. Use {.make}.
</span>  <span class='comment'>#
</span>  <span class='comment'># @private
</span>  <span class='comment'># @param bot [Rubirai::Bot, nil]
</span>  <span class='comment'># @param source [Array, nil]
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_bot'>bot</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_source'>source</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='ivar'>@bot</span> <span class='op'>=</span> <span class='id identifier rubyid_bot'>bot</span>
    <span class='ivar'>@messages</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='ivar'>@has_interpolation</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='ivar'>@interpolated_str</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='ivar'>@ipl_objs_map</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='ivar'>@raw</span> <span class='op'>=</span> <span class='id identifier rubyid_source'>source</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_source'>source</span>
    <span class='id identifier rubyid_raise'>raise</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="MiraiError.html" title="Rubirai::MiraiError (class)">MiraiError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>source is not array</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Array</span>
    <span class='id identifier rubyid_raise'>raise</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="MiraiError.html" title="Rubirai::MiraiError (class)">MiraiError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>length is zero</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_source'>source</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>type</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Source</span><span class='tstring_end'>&#39;</span></span>
      <span class='ivar'>@id</span> <span class='op'>=</span> <span class='id identifier rubyid_source'>source</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
      <span class='ivar'>@send_time</span> <span class='op'>=</span> <span class='id identifier rubyid_source'>source</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>time</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_drop'>drop</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_source'>source</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Convert the message chain to an array of hashes.
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Array&lt;Hash{String =&gt; Object}&gt;]
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_to_a'>to_a</span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_h</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_private'>private</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_internal_append'>internal_append</span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_must_be!'>must_be!</span> <span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Message</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">MessageChain</a></span></span><span class='comma'>,</span> <span class='const'>Hash</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="RubiraiError.html" title="Rubirai::RubiraiError (class)">RubiraiError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>msg must be Message, MessageChain, or Hash</span><span class='tstring_end'>&#39;</span></span>

    <span class='kw'>case</span> <span class='id identifier rubyid_msg'>msg</span>
    <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Message</a></span></span>
      <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span> <span class='id identifier rubyid_msg'>msg</span>
    <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">MessageChain</a></span></span>
      <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_messages'>messages</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span> <span class='const'><span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Message</a></span></span><span class='period'>.</span><span class='id identifier rubyid_build_from'>build_from</span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='ivar'>@bot</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>self</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="raw-instance_method">
  
    #<strong>raw</strong>  &#x21d2; <tt><span class='object_link'>Hash</span>{<span class='object_link'>String</span> =&gt; <span class='object_link'>Object</span>}</tt><sup>?</sup>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the raw message chain, may be <code>nil</code>.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'>Hash</span>{<span class='object_link'>String</span> =&gt; <span class='object_link'>Object</span>}</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the raw message chain, may be <code>nil</code></p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubirai/messages/message_chain.rb', line 19</span>

<span class='kw'>class</span> <span class='const'><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">MessageChain</a></span></span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Enumerable</span>

  <span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:bot</span><span class='comma'>,</span> <span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:raw</span><span class='comma'>,</span> <span class='symbol'>:send_time</span><span class='comma'>,</span> <span class='symbol'>:messages</span>

  <span class='comment'># Makes a message chain from a list of messages
</span>  <span class='comment'>#
</span>  <span class='comment'># @param messages [Array&lt;Rubirai::Message, Rubirai::MessageChain, Hash, String, Object&gt;] a list of messages
</span>  <span class='comment'># @param bot [Rubirai::Bot, nil]
</span>  <span class='comment'># @return [Rubirai::MessageChain] the message chain
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_make'>make</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_messages'>messages</span><span class='comma'>,</span> <span class='label'>bot:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_chain'>chain</span> <span class='op'>=</span> <span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_bot'>bot</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span> <span class='const'><span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Message</a></span></span><span class='period'>.</span><span class='id identifier rubyid_to_message'><span class='object_link'><a href="Message.html#to_message-class_method" title="Rubirai::Message.to_message (method)">to_message</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='id identifier rubyid_bot'>bot</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="PlainMessage.html" title="Rubirai::PlainMessage (class)">PlainMessage</a></span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="PlainMessage.html" title="Rubirai::PlainMessage (class)">PlainMessage</a></span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="PlainMessage.html" title="Rubirai::PlainMessage (class)">PlainMessage</a></span></span><span class='period'>.</span><span class='id identifier rubyid_from'><span class='object_link'><a href="PlainMessage.html#from-class_method" title="Rubirai::PlainMessage.from (method)">from</a></span></span><span class='lparen'>(</span><span class='label'>text:</span> <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span> <span class='op'>+</span> <span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span><span class='comma'>,</span> <span class='label'>bot:</span> <span class='id identifier rubyid_bot'>bot</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span> <span class='id identifier rubyid_msg'>msg</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_chain'>chain</span><span class='period'>.</span><span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_chain'>chain</span>
  <span class='kw'>end</span>

  <span class='comment'># Append messages to this message chain
</span>  <span class='comment'>#
</span>  <span class='comment'># @param messages [Array&lt;Rubirai::Message, Hash&gt;] a list of messages
</span>  <span class='comment'># @return [Rubirai::MessageChain] self
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_messages'>messages</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span>
      <span class='id identifier rubyid_internal_append'>internal_append</span> <span class='id identifier rubyid_msg'>msg</span>
    <span class='kw'>end</span>
    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>alias</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_extend'>extend</span>
  <span class='kw'>alias</span> <span class='id identifier rubyid_append'>append</span> <span class='id identifier rubyid_extend'>extend</span>

  <span class='comment'># Concats this message chain with another one
</span>  <span class='comment'>#
</span>  <span class='comment'># @param msg_chain [MessageChain] another message chain
</span>  <span class='comment'># @return [MessageChain] self
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_concat!'>concat!</span><span class='lparen'>(</span><span class='id identifier rubyid_msg_chain'>msg_chain</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_msg_chain'>msg_chain</span><span class='period'>.</span><span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span>
      <span class='id identifier rubyid_internal_append'>internal_append</span> <span class='id identifier rubyid_msg'>msg</span>
    <span class='kw'>end</span>
    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='op'>[]</span><span class='lparen'>(</span><span class='id identifier rubyid_idx'>idx</span><span class='rparen'>)</span>
    <span class='ivar'>@messages</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_length'>length</span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_size'>size</span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_empty?'>empty?</span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='kw'>end</span>

  <span class='comment'># Don&#39;t use the constructor. Use {.make}.
</span>  <span class='comment'>#
</span>  <span class='comment'># @private
</span>  <span class='comment'># @param bot [Rubirai::Bot, nil]
</span>  <span class='comment'># @param source [Array, nil]
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_bot'>bot</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_source'>source</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='ivar'>@bot</span> <span class='op'>=</span> <span class='id identifier rubyid_bot'>bot</span>
    <span class='ivar'>@messages</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='ivar'>@has_interpolation</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='ivar'>@interpolated_str</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='ivar'>@ipl_objs_map</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='ivar'>@raw</span> <span class='op'>=</span> <span class='id identifier rubyid_source'>source</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_source'>source</span>
    <span class='id identifier rubyid_raise'>raise</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="MiraiError.html" title="Rubirai::MiraiError (class)">MiraiError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>source is not array</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Array</span>
    <span class='id identifier rubyid_raise'>raise</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="MiraiError.html" title="Rubirai::MiraiError (class)">MiraiError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>length is zero</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_source'>source</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>type</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Source</span><span class='tstring_end'>&#39;</span></span>
      <span class='ivar'>@id</span> <span class='op'>=</span> <span class='id identifier rubyid_source'>source</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
      <span class='ivar'>@send_time</span> <span class='op'>=</span> <span class='id identifier rubyid_source'>source</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>time</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_drop'>drop</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_source'>source</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Convert the message chain to an array of hashes.
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Array&lt;Hash{String =&gt; Object}&gt;]
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_to_a'>to_a</span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_h</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_private'>private</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_internal_append'>internal_append</span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_must_be!'>must_be!</span> <span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Message</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">MessageChain</a></span></span><span class='comma'>,</span> <span class='const'>Hash</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="RubiraiError.html" title="Rubirai::RubiraiError (class)">RubiraiError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>msg must be Message, MessageChain, or Hash</span><span class='tstring_end'>&#39;</span></span>

    <span class='kw'>case</span> <span class='id identifier rubyid_msg'>msg</span>
    <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Message</a></span></span>
      <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span> <span class='id identifier rubyid_msg'>msg</span>
    <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">MessageChain</a></span></span>
      <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_messages'>messages</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span> <span class='const'><span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Message</a></span></span><span class='period'>.</span><span class='id identifier rubyid_build_from'>build_from</span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='ivar'>@bot</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>self</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="send_time-instance_method">
  
    #<strong>send_time</strong>  &#x21d2; <tt>Integer</tt><sup>?</sup>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the send time of the message chain, may be <code>nil</code>.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the send time of the message chain, may be <code>nil</code></p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubirai/messages/message_chain.rb', line 19</span>

<span class='kw'>class</span> <span class='const'><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">MessageChain</a></span></span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Enumerable</span>

  <span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:bot</span><span class='comma'>,</span> <span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:raw</span><span class='comma'>,</span> <span class='symbol'>:send_time</span><span class='comma'>,</span> <span class='symbol'>:messages</span>

  <span class='comment'># Makes a message chain from a list of messages
</span>  <span class='comment'>#
</span>  <span class='comment'># @param messages [Array&lt;Rubirai::Message, Rubirai::MessageChain, Hash, String, Object&gt;] a list of messages
</span>  <span class='comment'># @param bot [Rubirai::Bot, nil]
</span>  <span class='comment'># @return [Rubirai::MessageChain] the message chain
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_make'>make</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_messages'>messages</span><span class='comma'>,</span> <span class='label'>bot:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_chain'>chain</span> <span class='op'>=</span> <span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_bot'>bot</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span> <span class='const'><span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Message</a></span></span><span class='period'>.</span><span class='id identifier rubyid_to_message'><span class='object_link'><a href="Message.html#to_message-class_method" title="Rubirai::Message.to_message (method)">to_message</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='id identifier rubyid_bot'>bot</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="PlainMessage.html" title="Rubirai::PlainMessage (class)">PlainMessage</a></span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="PlainMessage.html" title="Rubirai::PlainMessage (class)">PlainMessage</a></span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="PlainMessage.html" title="Rubirai::PlainMessage (class)">PlainMessage</a></span></span><span class='period'>.</span><span class='id identifier rubyid_from'><span class='object_link'><a href="PlainMessage.html#from-class_method" title="Rubirai::PlainMessage.from (method)">from</a></span></span><span class='lparen'>(</span><span class='label'>text:</span> <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span> <span class='op'>+</span> <span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span><span class='comma'>,</span> <span class='label'>bot:</span> <span class='id identifier rubyid_bot'>bot</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span> <span class='id identifier rubyid_msg'>msg</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_chain'>chain</span><span class='period'>.</span><span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_chain'>chain</span>
  <span class='kw'>end</span>

  <span class='comment'># Append messages to this message chain
</span>  <span class='comment'>#
</span>  <span class='comment'># @param messages [Array&lt;Rubirai::Message, Hash&gt;] a list of messages
</span>  <span class='comment'># @return [Rubirai::MessageChain] self
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_messages'>messages</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span>
      <span class='id identifier rubyid_internal_append'>internal_append</span> <span class='id identifier rubyid_msg'>msg</span>
    <span class='kw'>end</span>
    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>alias</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_extend'>extend</span>
  <span class='kw'>alias</span> <span class='id identifier rubyid_append'>append</span> <span class='id identifier rubyid_extend'>extend</span>

  <span class='comment'># Concats this message chain with another one
</span>  <span class='comment'>#
</span>  <span class='comment'># @param msg_chain [MessageChain] another message chain
</span>  <span class='comment'># @return [MessageChain] self
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_concat!'>concat!</span><span class='lparen'>(</span><span class='id identifier rubyid_msg_chain'>msg_chain</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_msg_chain'>msg_chain</span><span class='period'>.</span><span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span>
      <span class='id identifier rubyid_internal_append'>internal_append</span> <span class='id identifier rubyid_msg'>msg</span>
    <span class='kw'>end</span>
    <span class='kw'>self</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='op'>[]</span><span class='lparen'>(</span><span class='id identifier rubyid_idx'>idx</span><span class='rparen'>)</span>
    <span class='ivar'>@messages</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_length'>length</span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_size'>size</span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_empty?'>empty?</span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='kw'>end</span>

  <span class='comment'># Don&#39;t use the constructor. Use {.make}.
</span>  <span class='comment'>#
</span>  <span class='comment'># @private
</span>  <span class='comment'># @param bot [Rubirai::Bot, nil]
</span>  <span class='comment'># @param source [Array, nil]
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_bot'>bot</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_source'>source</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='ivar'>@bot</span> <span class='op'>=</span> <span class='id identifier rubyid_bot'>bot</span>
    <span class='ivar'>@messages</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='ivar'>@has_interpolation</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='ivar'>@interpolated_str</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='ivar'>@ipl_objs_map</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='ivar'>@raw</span> <span class='op'>=</span> <span class='id identifier rubyid_source'>source</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_source'>source</span>
    <span class='id identifier rubyid_raise'>raise</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="MiraiError.html" title="Rubirai::MiraiError (class)">MiraiError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>source is not array</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Array</span>
    <span class='id identifier rubyid_raise'>raise</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="MiraiError.html" title="Rubirai::MiraiError (class)">MiraiError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>length is zero</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_source'>source</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>type</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Source</span><span class='tstring_end'>&#39;</span></span>
      <span class='ivar'>@id</span> <span class='op'>=</span> <span class='id identifier rubyid_source'>source</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
      <span class='ivar'>@send_time</span> <span class='op'>=</span> <span class='id identifier rubyid_source'>source</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>time</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_drop'>drop</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_source'>source</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Convert the message chain to an array of hashes.
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [Array&lt;Hash{String =&gt; Object}&gt;]
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_to_a'>to_a</span>
    <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_h</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_private'>private</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_internal_append'>internal_append</span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_must_be!'>must_be!</span> <span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Message</a></span></span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">MessageChain</a></span></span><span class='comma'>,</span> <span class='const'>Hash</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="RubiraiError.html" title="Rubirai::RubiraiError (class)">RubiraiError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>msg must be Message, MessageChain, or Hash</span><span class='tstring_end'>&#39;</span></span>

    <span class='kw'>case</span> <span class='id identifier rubyid_msg'>msg</span>
    <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Message</a></span></span>
      <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span> <span class='id identifier rubyid_msg'>msg</span>
    <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">MessageChain</a></span></span>
      <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_messages'>messages</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span> <span class='const'><span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Message</a></span></span><span class='period'>.</span><span class='id identifier rubyid_build_from'>build_from</span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='ivar'>@bot</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>self</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="make-class_method">
  
    .<strong>make</strong>(*messages, bot: nil)  &#x21d2; <tt><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">Rubirai::MessageChain</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Makes a message chain from a list of messages</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>messages</span>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Rubirai::Message</a></span>, <span class='object_link'><a href="" title="Rubirai::MessageChain (class)">Rubirai::MessageChain</a></span>, <span class='object_link'>Hash</span>, <span class='object_link'>String</span>, <span class='object_link'>Object</span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>a list of messages</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>bot</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Bot.html" title="Rubirai::Bot (class)">Rubirai::Bot</a></span></tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">Rubirai::MessageChain</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the message chain</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


29
30
31
32
33
34
35
36
37
38
39
40
41</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubirai/messages/message_chain.rb', line 29</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_make'>make</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_messages'>messages</span><span class='comma'>,</span> <span class='label'>bot:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_chain'>chain</span> <span class='op'>=</span> <span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_bot'>bot</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span> <span class='const'><span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Message</a></span></span><span class='period'>.</span><span class='id identifier rubyid_to_message'><span class='object_link'><a href="Message.html#to_message-class_method" title="Rubirai::Message.to_message (method)">to_message</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='id identifier rubyid_bot'>bot</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="PlainMessage.html" title="Rubirai::PlainMessage (class)">PlainMessage</a></span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="PlainMessage.html" title="Rubirai::PlainMessage (class)">PlainMessage</a></span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="PlainMessage.html" title="Rubirai::PlainMessage (class)">PlainMessage</a></span></span><span class='period'>.</span><span class='id identifier rubyid_from'><span class='object_link'><a href="PlainMessage.html#from-class_method" title="Rubirai::PlainMessage.from (method)">from</a></span></span><span class='lparen'>(</span><span class='label'>text:</span> <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span> <span class='op'>+</span> <span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span><span class='comma'>,</span> <span class='label'>bot:</span> <span class='id identifier rubyid_bot'>bot</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span> <span class='id identifier rubyid_msg'>msg</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_chain'>chain</span><span class='period'>.</span><span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_chain'>chain</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="[]-instance_method">
  
    #<strong>[]</strong>(idx)  &#x21d2; <tt><span class='object_link'>Object</span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


68
69
70</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubirai/messages/message_chain.rb', line 68</span>

<span class='kw'>def</span> <span class='op'>[]</span><span class='lparen'>(</span><span class='id identifier rubyid_idx'>idx</span><span class='rparen'>)</span>
  <span class='ivar'>@messages</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="chain_from_interpolated-instance_method">
  
    #<strong>chain_from_interpolated</strong>(str)  &#x21d2; <tt><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">MessageChain</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Get a new chain from interpolated string generated from the original message chain.
The given interpolated string can be a substring of original one so that elements
can be extracted easily.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>str</span>
      
      
        <span class='type'>(<tt><span class='object_link'>String</span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the interpolated string</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">MessageChain</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the message chain constructed</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


35
36
37</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubirai/messages/interpolation.rb', line 35</span>

<span class='kw'>def</span> <span class='id identifier rubyid_chain_from_interpolated'>chain_from_interpolated</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='rparen'>)</span>
  <span class='id identifier rubyid__interpolate_with_objects'>_interpolate_with_objects</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="concat!-instance_method">
  
    #<strong>concat!</strong>(msg_chain)  &#x21d2; <tt><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">MessageChain</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Concats this message chain with another one</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>msg_chain</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">MessageChain</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>another message chain</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">MessageChain</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>self</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


61
62
63
64
65
66</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubirai/messages/message_chain.rb', line 61</span>

<span class='kw'>def</span> <span class='id identifier rubyid_concat!'>concat!</span><span class='lparen'>(</span><span class='id identifier rubyid_msg_chain'>msg_chain</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_msg_chain'>msg_chain</span><span class='period'>.</span><span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span>
    <span class='id identifier rubyid_internal_append'>internal_append</span> <span class='id identifier rubyid_msg'>msg</span>
  <span class='kw'>end</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="each-instance_method">
  
    #<strong>each</strong>(&amp;block)  &#x21d2; <tt><span class='object_link'>Object</span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


72
73
74</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubirai/messages/message_chain.rb', line 72</span>

<span class='kw'>def</span> <span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="empty?-instance_method">
  
    #<strong>empty?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


84
85
86</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubirai/messages/message_chain.rb', line 84</span>

<span class='kw'>def</span> <span class='id identifier rubyid_empty?'>empty?</span>
  <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="extend-instance_method">
  
    #<strong>extend</strong>(*messages)  &#x21d2; <tt><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">Rubirai::MessageChain</a></span></tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='<<-instance_method'>&lt;&lt;</span>, <span id='append-instance_method'>append</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Append messages to this message chain</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>messages</span>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Rubirai::Message</a></span>, <span class='object_link'>Hash</span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>a list of messages</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Rubirai::MessageChain (class)">Rubirai::MessageChain</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>self</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


47
48
49
50
51
52</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubirai/messages/message_chain.rb', line 47</span>

<span class='kw'>def</span> <span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_messages'>messages</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_messages'>messages</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span>
    <span class='id identifier rubyid_internal_append'>internal_append</span> <span class='id identifier rubyid_msg'>msg</span>
  <span class='kw'>end</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_object-instance_method">
  
    #<strong>get_object</strong>(obj_id)  &#x21d2; <tt><span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Message</a></span></tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Get the interpolated object by given id</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>obj_id</span>
      
      
        <span class='type'>(<tt><span class='object_link'>String</span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the object id</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Message.html" title="Rubirai::Message (class)">Message</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the message. <code>nil</code> if <code>obj_id</code> is malformed or not found.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


25
26
27</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubirai/messages/interpolation.rb', line 25</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_object'>get_object</span><span class='lparen'>(</span><span class='id identifier rubyid_obj_id'>obj_id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid__get_object'>_get_object</span><span class='lparen'>(</span><span class='id identifier rubyid_obj_id'>obj_id</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="interpolated_str-instance_method">
  
    #<strong>interpolated_str</strong>  &#x21d2; <tt><span class='object_link'>String</span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Convert the message chain to an interpolated string.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'>String</span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


14
15
16
17
18
19</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubirai/messages/interpolation.rb', line 14</span>

<span class='kw'>def</span> <span class='id identifier rubyid_interpolated_str'>interpolated_str</span>
  <span class='kw'>return</span> <span class='ivar'>@interpolated_str</span> <span class='kw'>if</span> <span class='ivar'>@has_interpolation</span>
  <span class='ivar'>@interpolated_str</span> <span class='op'>=</span> <span class='id identifier rubyid__gen_interp_str'>_gen_interp_str</span>
  <span class='ivar'>@has_interpolation</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='ivar'>@interpolated_str</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="length-instance_method">
  
    #<strong>length</strong>  &#x21d2; <tt><span class='object_link'>Object</span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


76
77
78</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubirai/messages/message_chain.rb', line 76</span>

<span class='kw'>def</span> <span class='id identifier rubyid_length'>length</span>
  <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="size-instance_method">
  
    #<strong>size</strong>  &#x21d2; <tt><span class='object_link'>Object</span></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


80
81
82</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubirai/messages/message_chain.rb', line 80</span>

<span class='kw'>def</span> <span class='id identifier rubyid_size'>size</span>
  <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_a-instance_method">
  
    #<strong>to_a</strong>  &#x21d2; <tt>Array&lt;<span class='object_link'>Hash</span>{<span class='object_link'>String</span> =&gt; <span class='object_link'>Object</span>}&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Convert the message chain to an array of hashes.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'>Hash</span>{<span class='object_link'>String</span> =&gt; <span class='object_link'>Object</span>}&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


116
117
118</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rubirai/messages/message_chain.rb', line 116</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_a'>to_a</span>
  <span class='ivar'>@messages</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_h</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Thu Feb 24 00:56:11 2022 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.27 (ruby-3.0.3).
</div>

    </div>
  </body>
</html>